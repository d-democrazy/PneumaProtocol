%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#1e3a8a',
    'primaryTextColor': '#ffffff',
    'primaryBorderColor': '#3b82f6',
    'lineColor': '#6366f1',
    'sectionBkgColor': '#f8fafc',
    'altSectionBkgColor': '#e2e8f0',
    'gridColor': '#cbd5e1',
    'secondaryColor': '#7c3aed',
    'tertiaryColor': '#059669',
    'background': '#ffffff',
    'mainBkg': '#ffffff',
    'secondBkg': '#f1f5f9',
    'tertiaryBkg': '#ecfdf5'
  },
  'flowchart': {
    'nodeSpacing': 50,
    'rankSpacing': 60,
    'curve': 'basis',
    'padding': 20
  }
}}%%

graph TD
    %% Network Activity Layer
    A["🌐 Blockchain Network Activity"] --> B["⚡ Transaction Processing"]
    B --> C["💰 Gas Fee Collection"]
    C --> D{"🔄 Transaction Type"}
    
    D --> E["📊 TxnFeePaid<br/>⚖️ Weight: 1.0"]
    D --> F["📈 TxnFeeInvolved<br/>⚖️ Weight: 0.25"]
    
    %% Score Calculation Layer
    E --> G["👤 Individual Wallet<br/>Score Calculation"]
    F --> G
    F --> H["📋 Contract Score<br/>Calculation"]
    
    G --> I["🧮 Score = TxnFeePaid +<br/>0.25 × TxnFeeInvolved"]
    H --> J["📊 RawScore =<br/>TxnFeeInvolved × 0.25"]
    
    %% Collateralization System
    K["🪙 PNEUMA Token Supply<br/>📦 2.1B Fixed"] --> L["🔒 Collateralization Pool"]
    L --> M["🔐 Lock Function<br/>lockFor(contract, amount)"]
    M --> N["📐 Collateralization Ratio<br/>r = P_c / S_PNEUMA"]
    
    N --> O["📈 Weight Amplification<br/>W_c = 0.25 + r_c × 0.75"]
    O --> P["🚀 Amplified Score<br/>AmplifiedScore = TxnFeeInvolved × W_c"]
    
    J --> P
    
    %% Cumulative Scoring
    I --> Q["📈 Cumulative Lifetime Score"]
    P --> R["📊 Cumulative Contract Score"]
    
    Q --> S["∑ CumulativeScore_j,i =<br/>Sum from k=1 to i Score_j,k"]
    R --> T["∑ CumulativeScore_c,i =<br/>Sum from k=1 to i AmplifiedScore_c,k"]
    
    %% Epoch System
    U["⏰ 25 Epochs × 4 Years Each<br/>🕐 100 Year Cycle"] --> V["📉 Deflationary Allocation"]
    V --> W["🎯 S_1 = 226M PNEUMA<br/>📉 S_i = S_1 × 0.9^(i-1)"]
    
    %% Reward Distribution
    S --> X["🌐 Network Total<br/>Cumulative Score"]
    X --> Y["🎁 Reward Calculation"]
    W --> Y
    Y --> Z["💎 Reward_j,i =<br/>CumulativeScore_j,i / NetworkTotal × S_i"]
    
    %% Token Valuation
    T --> AA["💰 Token Valuation"]
    AA --> BB["📊 V_t,i = CumulativeScore_c,i"]
    BB --> CC["🏷️ Per-Token Value<br/>V_per-token = V_t,i / S_t"]
    
    %% Exchange System
    CC --> DD["💱 Token Exchange Rates"]
    DD --> EE["⚖️ Rate_A→B = V_A / V_B"]
    
    %% Constraints
    FF["⚠️ Ecosystem Constraints"] --> GG["🔒 Sum V_t,i ≤ 2.1B PNEUMA"]
    BB --> GG
    
    %% LaunchPad Integration
    HH["🚀 LaunchPad Platform"] --> II["📝 Token Registration"]
    HH --> JJ["🛡️ Collateral Management"]
    HH --> KK["📊 Valuation Monitoring"]
    
    II --> M
    JJ --> L
    KK --> BB
    
    %% Time Flow
    LL["⏳ Time Progression"] --> MM["🔄 Epoch Transition"]
    MM --> NN["📊 Score Reset: ❌<br/>Cumulative: ✅"]
    MM --> OO["🧮 New Allocation<br/>Calculation"]
    
    NN --> Q
    NN --> R
    OO --> W
    
    %% Value Growth Dynamics
    PP["📈 Growth Mechanisms"] --> QQ["🔥 Utility Growth<br/>↑ Contract Activity"]
    PP --> RR["💎 Collateral Growth<br/>↑ PNEUMA Locked"]
    
    QQ --> H
    RR --> N
    
    %% Enhanced Styling
    classDef networkLayer fill:#dbeafe,stroke:#3b82f6,stroke-width:3px,color:#1e40af,font-weight:bold
    classDef rewardSystem fill:#dcfce7,stroke:#22c55e,stroke-width:2px,color:#166534,font-weight:bold
    classDef valuationSystem fill:#fce7f3,stroke:#ec4899,stroke-width:2px,color:#be185d,font-weight:bold
    classDef collateralization fill:#fed7aa,stroke:#f97316,stroke-width:2px,color:#c2410c,font-weight:bold
    classDef epochSystem fill:#e0e7ff,stroke:#6366f1,stroke-width:2px,color:#4338ca,font-weight:bold
    classDef constraints fill:#fecaca,stroke:#ef4444,stroke-width:3px,color:#dc2626,font-weight:bold
    classDef launchpad fill:#f3e8ff,stroke:#a855f7,stroke-width:2px,color:#7c2d12,font-weight:bold
    classDef calculation fill:#fef3c7,stroke:#f59e0b,stroke-width:2px,color:#d97706,font-weight:bold
    classDef growth fill:#ccfbf1,stroke:#14b8a6,stroke-width:2px,color:#0f766e,font-weight:bold
    
    class A,B,C,D networkLayer
    class E,F,G,H,I,J,Q,R,S,T,X,Y,Z rewardSystem
    class AA,BB,CC,DD,EE valuationSystem
    class K,L,M,N,O,P collateralization
    class U,V,W,LL,MM,NN,OO epochSystem
    class FF,GG constraints
    class HH,II,JJ,KK launchpad
    class PP,QQ,RR growth